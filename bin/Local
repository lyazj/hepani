#!/usr/bin/env python3

import os
import sys

if len(sys.argv) < 2:
    sys.stderr.write("Missing input filename.\n")
    sys.exit(1)
input_file = sys.argv[1]
if input_file[-4:] == ".log" or input_file[-4:] == ".txt":
    input_type = "py8log"
elif input_file[-6:] == ".hepmc":
    input_type = "hepmc2"
else:
    sys.stderr.write("Unrecognized filetype.\n")
    sys.exit(1)

if not os.path.isdir("tmp"):
    os.mkdir("tmp")
output_file = os.path.join("tmp", "run_" + str(os.getpid()) + ".js")
r = os.system("bin/Hepani -l --d0 0.001 --d1 5"
        f" --type {input_type} < {input_file} > {output_file}")
if r:
    sys.exit(1)

os.system(f"firefox 'ani.html?local&load={output_file}'")
